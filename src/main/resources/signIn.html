<!DOCTYPE html>
<!--suppress ALL -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sign in</title>


    <!--TODO move into separate file-->
    <script>

        const MAIN_PAGE = "http://localhost:8080"
        const LOGIN_PAGE = MAIN_PAGE + "/login"

        function onSignIn(googleUser) {
            const token = googleUser.getAuthResponse().id_token;
            const email = googleUser.getBasicProfile().getEmail();
            validateAdminOnServer(email, token)
        }

        function validateAdminOnServer(email, token) {
            $.ajax({
                type: "POST",
                url: LOGIN_PAGE,
                data: "email=" + email + "&token=" + token,
                contentType: "application/x-www-form-urlencoded",
                statusCode: {
                    200: function () {window.location.href = MAIN_PAGE},
                    401: signOut(),
                    500: signOut()
                }
            })
        }

        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut();
            window.location.href = LOGIN_PAGE;
        }

    </script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://apis.google.com/js/platform.js" ></script>
    <meta name="google-signin-client_id"
          content="988935906987-97ups7r848cfk71he7jp360svui2jich.apps.googleusercontent.com">
</head>


<body>
<div class="g-signin2" data-onsuccess="onSignIn" data-prompt="select_account"></div>
</body>
</html>